<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="category">

	<!--리스트에서 하나씩 게시판들을 가져와서 1:n관계로 이뤄진 게시물들 list에 담기 -->
	<resultMap type="user.vo.CategoryVO" id="map1">
		<id property="evcategory_idx" column="evcategory_idx"/>
		<collection property="bbs_list" ofType="user.vo.BbsVO"
			select="bbsList" column="evcategory_idx"/>
	</resultMap>
	
	<!-- 특정 게시판의 기본키인 idx를 받아서 해당 게시판에 게시물들을 모두 반환한다. -->
	<select id="bbsList" parameterType="String" resultType="user.vo.BbsVO">
		SELECT * FROM evbbs_t
		WHERE evcategory_idx = #{evcategory_idx}
	</select>
	
	<resultMap type="user.vo.CategoryVO" id="map2">
	<id property="evcategory_idx" column="evcategory_idx"/>
	<collection property="bbs_list" ofType="user.vo.BbsVO"
		select="homebbsList" column="evcategory_idx"/>
</resultMap>

	<!-- 특정 게시판의 기본키인 idx를 받아서 해당 게시판에 게시물들을 모두 반환한다. -->
	<select id="homebbsList" parameterType="String" resultType="user.vo.BbsVO">
		SELECT * FROM(
		SELECT rownum r_num,a.* FROM(
		SELECT * FROM evbbs_t
		WHERE evbbs_status = 0 AND evcategory_idx = #{evcategory_idx}
		ORDER BY evbbs_idx DESC
		) a
		) WHERE r_num BETWEEN 1 AND 6
	</select>

	<!-- 해당 vo를 통해서 현재 카테고리 위치 표현 -->
	<select id="nowCategory" resultMap="map1" parameterType="String">
		select * from evcategory_t
		where evcategory_status = 0 and evcategory_idx=#{category_idx}
	</select>
	
	<!-- 헤더ㆍ푸터에 게시판 목록을 표시 및 해당 게시판으로 이동하기 위해서 게시판 리스트 가져오기 -->
	<select id="categoryNameList" resultMap="map2" >
		select * from evcategory_t
		where evcategory_status = 0 
		order by evcategory_idx asc
	</select>
	
</mapper>